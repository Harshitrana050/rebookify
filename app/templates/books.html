<!DOCTYPE html>
<html>
<head><title>Books - Rebookify</title></head>
<body>
  <h1>Available Books</h1>

  <!-- Search and filter form -->
  <form method="GET" action="{{ url_for('books') }}">
    <input type="text" name="title" value="{{ title }}" placeholder="Search by Title" />
    <input type="text" name="author" value="{{ author }}" placeholder="Search by Author" />
    <input type="number" step="0.01" name="min_price" value="{{ min_price }}" placeholder="Min Price" />
    <input type="number" step="0.01" name="max_price" value="{{ max_price }}" placeholder="Max Price" />
    <input type="submit" value="Search" />
    <a href="{{ url_for('books') }}">Clear</a>
  </form>

  <p><a href="{{ url_for('add_book') }}">Add New Book</a></p>

  <ul>
    {% for book in books %}
      <li>
        <h3>{{book.title}} by {{book.author}}</h3>
        <p>Condition: {{book.condition}}</p>
        <p>Price: ${{'%.2f'|format(book.price)}}</p>
        <p>Seller: {{book.seller.name}}</p>
        <p>Description: {{book.description}}</p>
        {% if book.image_url %}
          <img src="{{book.image_url}}" alt="Book Image" width="150" />
        {% endif %}
        <p><a href="{{ url_for('messages', user_id=book.seller.id) }}">Message Seller</a></p>

        {% if current_user.is_authenticated and current_user.id == book.seller.id %}
          <p>
            <a href="{{ url_for('edit_book', book_id=book.id) }}">Edit</a> | 
            <form method="POST" action="{{ url_for('delete_book', book_id=book.id) }}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this book?');">
              <button type="submit">Delete</button>
            </form>
          </p>
        {% endif %}
      </li>
    {% else %}
      <li>No books found.</li>
    {% endfor %}
  </ul>

  <p><a href="{{ url_for('home') }}">Back to Home</a></p>
</body>
</html>
